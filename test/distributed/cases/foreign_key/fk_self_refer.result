#SQL[@1,N37]Result[]
drop database if exists fk_self_refer;

#SQL[@2,N29]Result[]
create database fk_self_refer;

#SQL[@3,N17]Result[]
use fk_self_refer;

#SQL[@7,N23]Result[]
drop table if exists t1;

#SQL[@8,N93]Result[]
create table t1(a int primary key,b int, constraint `c1` foreign key fk1(b) references t1(a));

#SQL[@9,N11]Result[23, 2]
show tables;
Tables_in_fk_self_refer
t1

#SQL[@10,N20]Result[23, 190]
show create table t1;
Table  ¦  Create Table
t1  ¦  CREATE TABLE `t1` (
  `a` int NOT NULL,
  `b` int DEFAULT NULL,
  PRIMARY KEY (`a`),
  CONSTRAINT `c1` FOREIGN KEY (`b`) REFERENCES `t1` (`a`) ON DELETE RESTRICT ON UPDATE RESTRICT
)

#SQL[@11,N27]Result[]
insert into t1 values (1,1);

#SQL[@12,N27]Result[]
insert into t1 values (2,1);

#SQL[@13,N27]Result[]
insert into t1 values (3,2);

#SQL[@16,N27]Error[64]
insert into t1 values (5,4);
Cannot add or update a child row: a foreign key constraint fails

#SQL[@19,N30]Result[]
insert into t1 values (4,NULL);

#SQL[@22,N27]Result[]
insert into t1 values (5,4);

#SQL[@25,N25]Error[84]
delete from t1 where a= 4;
internal error: Cannot delete or update a parent row: a foreign key constraint fails

#SQL[@28,N25]Result[]
delete from t1 where a= 5;

#SQL[@31,N25]Result[]
delete from t1 where a= 4;

#SQL[@34,N27]Result[]
insert into t1 values (4,4);

#SQL[@36,N16]Result[8, 8, 8, 8, 8]
select * from t1;
a  ¦  b
1  ¦  1
2  ¦  1
3  ¦  2
4  ¦  4

#SQL[@39,N26]Error[84]
delete from t1 where a = 4;
internal error: Cannot delete or update a parent row: a foreign key constraint fails

#SQL[@42,N33]Result[]
update t1 set b = NULL where a= 4;

#SQL[@45,N26]Result[]
delete from t1 where a = 4;

#SQL[@47,N23]Result[]
drop table if exists t1;

#SQL[@50,N86]Result[]
create table t1(a int primary key,b int not null, foreign key fk1(b) references t1(a));

#SQL[@52,N27]Result[]
insert into t1 values (4,4);

#SQL[@55,N25]Error[84]
delete from t1 where a= 4;
internal error: Cannot delete or update a parent row: a foreign key constraint fails

#SQL[@58,N31]Error[47]
update t1 set b=NULL where a= 4;
constraint violation: Column 'b' cannot be null

#SQL[@61,N28]Error[64]
update t1 set b=5 where a= 4;
Cannot add or update a child row: a foreign key constraint fails

#SQL[@64,N27]Result[]
insert into t1 values (3,4);

#SQL[@67,N30]Result[]
update t1 set b = 3 where a= 4;

#SQL[@70,N16]Result[8, 8, 8]
select * from t1;
a  ¦  b
3  ¦  4
4  ¦  3

#SQL[@73,N26]Error[84]
delete from t1 where a = 3;
internal error: Cannot delete or update a parent row: a foreign key constraint fails

#SQL[@75,N26]Error[84]
delete from t1 where a = 4;
internal error: Cannot delete or update a parent row: a foreign key constraint fails

#SQL[@78,N30]Result[]
update t1 set b = 4 where a =4;

#SQL[@81,N26]Result[]
delete from t1 where a = 3;

#SQL[@86,N23]Result[]
drop table if exists t1;

#SQL[@87,N91]Result[]
create table t1(a int unique key,b int,constraint `c1` foreign key fk1(b) references t1(a));

#SQL[@88,N11]Result[23, 2]
show tables;
Tables_in_fk_self_refer
t1

#SQL[@89,N20]Result[23, 197]
show create table t1;
Table  ¦  Create Table
t1  ¦  CREATE TABLE `t1` (
  `a` int DEFAULT NULL,
  `b` int DEFAULT NULL,
  UNIQUE KEY `a` (`a`),
  CONSTRAINT `c1` FOREIGN KEY (`b`) REFERENCES `t1` (`a`) ON DELETE RESTRICT ON UPDATE RESTRICT
)

#SQL[@90,N27]Result[]
insert into t1 values (1,1);

#SQL[@91,N27]Result[]
insert into t1 values (2,1);

#SQL[@92,N27]Result[]
insert into t1 values (3,2);

#SQL[@95,N27]Error[64]
insert into t1 values (5,4);
Cannot add or update a child row: a foreign key constraint fails

#SQL[@98,N30]Result[]
insert into t1 values (4,NULL);

#SQL[@101,N27]Result[]
insert into t1 values (5,4);

#SQL[@104,N25]Error[84]
delete from t1 where a= 4;
internal error: Cannot delete or update a parent row: a foreign key constraint fails

#SQL[@107,N25]Result[]
delete from t1 where a= 5;

#SQL[@110,N25]Result[]
delete from t1 where a= 4;

#SQL[@113,N27]Result[]
insert into t1 values (4,4);

#SQL[@115,N16]Result[8, 8, 8, 8, 8]
select * from t1;
a  ¦  b
1  ¦  1
2  ¦  1
3  ¦  2
4  ¦  4

#SQL[@118,N26]Error[84]
delete from t1 where a = 4;
internal error: Cannot delete or update a parent row: a foreign key constraint fails

#SQL[@121,N33]Result[]
update t1 set b = NULL where a= 4;

#SQL[@124,N26]Result[]
delete from t1 where a = 4;

#SQL[@127,N34]Result[]
update t1 set a = NULL where a = 3;

#SQL[@130,N33]Result[]
insert into t1 values (NULL,NULL);

#SQL[@133,N30]Error[64]
insert into t1 values (NULL,3);
Cannot add or update a child row: a foreign key constraint fails

#SQL[@136,N30]Result[]
insert into t1 values (NULL,2);

#SQL[@141,N23]Result[]
drop table if exists t1;

#SQL[@143,N73]Error[56]
create table t1(a int,b int,key (a), foreign key fk1(b) references t1(a));
internal error: failed to add the foreign key constraint

#SQL[@195,N23]Result[]
drop table if exists t1;

#SQL[@197,N37]Result[]
drop database if exists fk_self_refer;

