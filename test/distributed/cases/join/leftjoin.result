#SQL[@1,N26]Result[]
drop database if exists d1;

#SQL[@2,N18]Result[]
create database d1;

#SQL[@3,N6]Result[]
use d1;

#SQL[@4,N23]Result[]
drop table if exists t1;

#SQL[@5,N23]Result[]
drop table if exists t2;

#SQL[@6,N23]Result[]
drop table if exists t3;

#SQL[@7,N35]Result[]
create table t1(c1 int primary key);

#SQL[@8,N51]Result[]
create table t2(c1 int primary key, c2 int, c3 int);

#SQL[@9,N59]Result[]
create table t3(c1 int, c2 int, c3 int, primary key(c1,c2));

#SQL[@10,N53]Result[]
insert into t1 select * from generate_series(10000) g;

#SQL[@11,N40]Result[]
insert into t2 select c1, c1, c1 from t1;

#SQL[@12,N58]Result[]
insert into t2 select c1+10000, c1+10000, c1+10000 from t1;

#SQL[@13,N40]Result[]
insert into t3 select c1, c1, c1 from t1;

#SQL[@14,N58]Result[]
insert into t3 select c1+10000, c1+10000, c1+10000 from t1;

#SQL[@15,N58]Result[]
insert into t3 select c1+20000, c1+20000, c1+20000 from t1;

#SQL[@17,N37]Result[24, 79]
select mo_ctl('dn', 'flush', 'd1.t1');
mo_ctl(dn, flush, d1.t1)
{
  "method": "Flush",
  "result": [
    {
      "returnStr": "OK"
    }
  ]
}


#SQL[@19,N37]Result[24, 79]
select mo_ctl('dn', 'flush', 'd1.t2');
mo_ctl(dn, flush, d1.t2)
{
  "method": "Flush",
  "result": [
    {
      "returnStr": "OK"
    }
  ]
}


#SQL[@21,N37]Result[24, 79]
select mo_ctl('dn', 'flush', 'd1.t3');
mo_ctl(dn, flush, d1.t3)
{
  "method": "Flush",
  "result": [
    {
      "returnStr": "OK"
    }
  ]
}


#SQL[@23,N57]Result[13, 7, 25]
explain select t2.c1 from t2 left join t1 on t1.c1 =t2.c1;
TP QUERY PLAN
Project
  ->  Table Scan on d1.t2

#SQL[@25,N63]Result[13, 7, 10, 34, 34, 31, 31]
explain select t1.c1,t2.c1 from t2 left join t1 on t1.c1 =t2.c1;
TP QUERY PLAN
Project
  ->  Join
        Join Type: LEFT   hashOnPK
        Join Cond: (t2.c1 = t1.c1)
        ->  Table Scan on d1.t2
        ->  Table Scan on d1.t1

#SQL[@27,N90]Result[13, 7, 25, 33, 39]
explain select t3.c1 from t3 left join t1 on t1.c1 =t3.c1 and t1.c1 > t3.c2 where t3.c1<10;
TP QUERY PLAN
Project
  ->  Table Scan on d1.t3
        Filter Cond: (t3.c1 < 10)
        Block Filter Cond: (t3.c1 < 10)

#SQL[@29,N78]Result[13, 7, 10, 34, 34, 31, 39, 45, 31, 39, 45]
explain select t1.c1,t3.c1 from t3 left join t1 on t1.c1 =t3.c1 where t3.c1<10;
TP QUERY PLAN
Project
  ->  Join
        Join Type: LEFT   hashOnPK
        Join Cond: (t3.c1 = t1.c1)
        ->  Table Scan on d1.t3
              Filter Cond: (t3.c1 < 10)
              Block Filter Cond: (t3.c1 < 10)
        ->  Table Scan on d1.t1
              Filter Cond: (t1.c1 < 10)
              Block Filter Cond: (t1.c1 < 10)

#SQL[@31,N57]Result[13, 7, 25]
explain select t2.c1 from t2 left join t1 on t1.c1 =t2.c2;
TP QUERY PLAN
Project
  ->  Table Scan on d1.t2

#SQL[@33,N56]Result[13, 7, 10, 23, 34, 31, 31]
explain select t3.c1 from t3 left join t2 on t3.c2=t2.c2;
TP QUERY PLAN
Project
  ->  Join
        Join Type: LEFT
        Join Cond: (t3.c2 = t2.c2)
        ->  Table Scan on d1.t3
        ->  Table Scan on d1.t2

#SQL[@35,N125]Result[13, 7, 25]
explain select t2.c1 from t2 left join (select t3.c1,t3.c2 from t1 join t3 on t1.c1=t3.c1) v1 on t2.c1 =v1.c1 and t2.c2=v1.c2;
TP QUERY PLAN
Project
  ->  Table Scan on d1.t2

#SQL[@37,N120]Result[13, 7, 10, 23, 34, 31, 19, 25, 22, 47, 46, 43, 43]
explain select t2.c1 from t2 left join (select t3.c1,t3.c2 from t1 join t3 on t1.c1=t3.c1 limit 5000) v1 on t2.c1 =v1.c1;
TP QUERY PLAN
Project
  ->  Join
        Join Type: LEFT
        Join Cond: (t2.c1 = v1.c1)
        ->  Table Scan on d1.t2
        ->  Project
              Limit: 5000
              ->  Join
                    Join Type: INNER   hashOnPK
                    Join Cond: (t3.c1 = t1.c1)
                    ->  Table Scan on d1.t3
                    ->  Table Scan on d1.t1

#SQL[@38,N31]Result[]
drop table if exists parameters;

#SQL[@39,N717]Result[]
CREATE TABLE `parameters` (
`specific_catalog` VARCHAR(64) DEFAULT null,
`specific_schema` VARCHAR(64) DEFAULT null,
`specific_name` VARCHAR(64) DEFAULT null,
`ordinal_position` BIGINT UNSIGNED DEFAULT null,
`parameter_mode` VARCHAR(5) DEFAULT null,
`parameter_name` VARCHAR(64) DEFAULT null,
`data_type` TEXT DEFAULT null,
`character_maximum_length` BIGINT DEFAULT null,
`character_octet_length` BIGINT DEFAULT null,
`numeric_precision` INT UNSIGNED DEFAULT null,
`numeric_scale` BIGINT DEFAULT null,
`datetime_precision` INT UNSIGNED DEFAULT null,
`character_set_name` VARCHAR(64) DEFAULT null,
`collation_name` VARCHAR(64) DEFAULT null,
`dtd_identifier` TEXT DEFAULT null,
`routine_type` VARCHAR(64) DEFAULT null
);

#SQL[@57,N29]Result[]
drop table if exists routines;

#SQL[@58,N1335]Result[]
CREATE TABLE `routines` (
`specific_name` VARCHAR(64) DEFAULT null,
`routine_catalog` VARCHAR(64) DEFAULT null,
`routine_schema` VARCHAR(64) DEFAULT null,
`routine_name` VARCHAR(64) DEFAULT null,
`routine_type` VARCHAR(10) DEFAULT null,
`data_type` TEXT DEFAULT null,
`character_maximum_length` BIGINT DEFAULT null,
`character_octet_length` BIGINT DEFAULT null,
`numeric_precision` INT UNSIGNED DEFAULT null,
`numeric_scale` INT UNSIGNED DEFAULT null,
`datetime_precision` INT UNSIGNED DEFAULT null,
`character_set_name` VARCHAR(64) DEFAULT null,
`collation_name` VARCHAR(64) DEFAULT null,
`dtd_identifier` TEXT DEFAULT null,
`routine_body` VARCHAR(3) DEFAULT null,
`routine_definition` TEXT DEFAULT null,
`external_name` BINARY(0) DEFAULT null,
`external_language` VARCHAR(64) DEFAULT null,
`parameter_style` VARCHAR(3) DEFAULT null,
`is_deterministic` VARCHAR(3) DEFAULT null,
`sql_data_access` VARCHAR(10) DEFAULT null,
`sql_path` VARCHAR(1000) DEFAULT null,
`security_type` VARCHAR(10) DEFAULT null,
`created` TIMESTAMP DEFAULT null,
`last_altered` TIMESTAMP DEFAULT null,
`sql_mode` VARCHAR(1000) DEFAULT null,
`routine_comment` TEXT DEFAULT null,
`definer` VARCHAR(288) DEFAULT null,
`character_set_client` VARCHAR(64) DEFAULT null,
`collation_connection` VARCHAR(64) DEFAULT null,
`database_collation` VARCHAR(64) DEFAULT null
);

#SQL[@91,N207]Result[]
insert into parameters values('specific_name01','specific_name01','routine_name02',100,'a','parametername01','data_type01',1248483647,100,10,32,10,'character01','callation_name01','dtd_identifier01','rrr01');

#SQL[@92,N207]Result[]
insert into parameters values('specific_name01','specific_name01','routine_name01',100,'a','parametername01','data_type01',1248483647,100,10,32,10,'character01','callation_name01','dtd_identifier01','rrr01');

#SQL[@93,N207]Result[]
insert into parameters values('specific_name01','specific_name02','routine_name01',100,'a','parametername01','data_type01',1248483647,100,10,32,10,'character01','callation_name01','dtd_identifier01','rrr01');

#SQL[@94,N207]Result[]
insert into parameters values('specific_name01','specific_name02','routine_name02',100,'a','parametername01','data_type01',1248483647,100,10,32,10,'character01','callation_name01','dtd_identifier01','rrr02');

#SQL[@95,N207]Result[]
insert into parameters values('specific_name01','specific_name01','routine_name01',100,'a','parametername01','data_type01',1248483647,100,10,32,10,'character01','callation_name01','dtd_identifier01','rrr02');

#SQL[@96,N207]Result[]
insert into parameters values('specific_name01','specific_name01','routine_name01',100,'a','parametername01','data_type01',1248483647,100,10,32,10,'character01','callation_name01','dtd_identifier01','rrr02');

#SQL[@97,N451]Result[]
insert into routines values('specific_name01','routine_catalog01','specific_name01','routine_name02','rrr02','data',10,10,10,20,20,'character_set_name','collation_name01','dtd_identifier01','111','routine_definition01','1','external_language01','aaa','bbb','sql_data','sql_path01','111','2020-10-10 12:12:12.000','2021-10-10 12:12:12.000','sql_mode01','routine_comment01','definer01','character_set_client','collation_connection','database_collation');

#SQL[@98,N451]Result[]
insert into routines values('specific_name01','routine_catalog01','specific_name01','routine_name02','rrr02','data',10,10,10,20,20,'character_set_name','collation_name01','dtd_identifier01','111','routine_definition01','1','external_language01','aaa','bbb','sql_data','sql_path01','111','2020-10-10 12:12:12.000','2021-10-10 12:12:12.000','sql_mode01','routine_comment01','definer01','character_set_client','collation_connection','database_collation');

#SQL[@99,N444]Result[]
insert into routines values('specific_name01','routine_catalog01','specific_name01','routine_name01','rrr01','data',10,10,10,20,20,'character_set_name','collation','dtd_identifier01','111','routine_definition01','1','external_language01','aaa','bbb','sql_data','sql_path01','111','2020-10-10 12:12:12.000','2021-10-10 12:12:12.000','sql_mode01','routine_comment01','definer01','character_set_client','collation_connection','database_collation');

#SQL[@100,N444]Result[]
insert into routines values('specific_name02','routine_catalog02','specific_name01','routine_name01','rrr01','data',10,10,10,20,20,'character_set_name','collation','dtd_identifier01','111','routine_definition01','1','external_language01','aaa','bbb','sql_data','sql_path01','111','2020-10-10 12:12:12.000','2021-10-10 12:12:12.000','sql_mode01','routine_comment01','definer01','character_set_client','collation_connection','database_collation');

#SQL[@101,N444]Result[]
insert into routines values('specific_name01','routine_catalog01','specific_name02','routine_name02','rrr02','data',10,10,10,20,20,'character_set_name','collation','dtd_identifier01','111','routine_definition01','1','external_language01','aaa','bbb','sql_data','sql_path01','111','2020-10-10 12:12:12.000','2021-10-10 12:12:12.000','sql_mode01','routine_comment01','definer01','character_set_client','collation_connection','database_collation');

#SQL[@103,N538]Result[47, 45, 68]
SELECT DISTINCT ROUTINE_SCHEMA, ROUTINE_NAME, PARAMS.PARAMETER FROM ROUTINES LEFT JOIN ( SELECT SPECIFIC_SCHEMA, SPECIFIC_NAME, GROUP_CONCAT(CONCAT(DATA_TYPE, ' ', PARAMETER_NAME) ORDER BY ORDINAL_POSITION SEPARATOR ', ') PARAMETER, ROUTINE_TYPE FROM PARAMETERS GROUP BY SPECIFIC_SCHEMA, SPECIFIC_NAME, ROUTINE_TYPE ) PARAMS ON ROUTINES.ROUTINE_SCHEMA = PARAMS.SPECIFIC_SCHEMA AND ROUTINES.ROUTINE_NAME = PARAMS.SPECIFIC_NAME AND ROUTINES.ROUTINE_TYPE = PARAMS.ROUTINE_TYPE WHERE ROUTINE_SCHEMA = 'specific_name01' ORDER BY ROUTINE_SCHEMA;
ROUTINE_SCHEMA  ¦  ROUTINE_NAME  ¦  PARAMETER
specific_name01  ¦  routine_name02  ¦  null
specific_name01  ¦  routine_name01  ¦  data_type01 parametername01

#SQL[@104,N19]Result[]
drop table routines;

#SQL[@105,N21]Result[]
drop table parameters;

#SQL[@107,N30]Result[]
create table x1 (a int, b int);

#SQL[@108,N44]Result[]
insert into x1 values (1, 1), (2, 2), (3, 3);

#SQL[@110,N66]Result[]
insert into x1 select 42, result from generate_series(1,20000,1) g;

#SQL[@111,N40]Result[]
insert into x1 values (10, 10), (20, 20);

#SQL[@112,N55]Result[]
create table x2 as select * from x1 order by a limit 10;

#SQL[@113,N51]Result[8, 6]
select count(*) from x2 left join x1 on x1.a = x2.a;
count(*)
100005

#SQL[@114,N67]Result[22, 22, 22, 22, 26, 26, 24, 24, 24, 24, 24]
select * from x2 left join x1 on x1.a = x2.a order by x1.a limit 10;
a  ¦  b  ¦  a  ¦  b
1  ¦  1  ¦  1  ¦  1
2  ¦  2  ¦  2  ¦  2
3  ¦  3  ¦  3  ¦  3
10  ¦  10  ¦  10  ¦  10
20  ¦  20  ¦  20  ¦  20
42  ¦  1  ¦  42  ¦  1
42  ¦  2  ¦  42  ¦  1
42  ¦  3  ¦  42  ¦  1
42  ¦  4  ¦  42  ¦  1
42  ¦  5  ¦  42  ¦  1

#SQL[@115,N13]Result[]
drop table x1;

#SQL[@116,N13]Result[]
drop table x2;

#SQL[@118,N26]Result[]
drop database if exists d1;

