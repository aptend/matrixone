#SQL[@2,N36]Result[63, 68]
select * from unnest('{"a":1}') as f;
col  ¦  seq  ¦  key  ¦  path  ¦  index  ¦  value  ¦  this
UNNEST_DEFAULT  ¦  0  ¦  a  ¦  $.a  ¦  null  ¦  1  ¦  {"a": 1}

#SQL[@3,N43]Result[]
select * from unnest('{"a":1}', '$.a') as f;

#SQL[@4,N49]Result[63, 67]
select * from unnest('{"a":1}', '$.a', true) as f;
col  ¦  seq  ¦  key  ¦  path  ¦  index  ¦  value  ¦  this
UNNEST_DEFAULT  ¦  0  ¦  null  ¦  $.a  ¦  null  ¦  null  ¦  1

#SQL[@5,N31]Error[32]
select * from unnest('{"a":1}');
SQL parser error: No tables used

#SQL[@6,N38]Error[32]
select * from unnest('{"a":1}', '$.a');
SQL parser error: No tables used

#SQL[@7,N44]Error[32]
select * from unnest('{"a":1}', '$.a', true);
SQL parser error: No tables used

#SQL[@10,N23]Result[]
drop table if exists t1;

#SQL[@11,N30]Result[]
create table t1 (a json,b int);

#SQL[@12,N98]Result[]
insert into t1 values ('{"a":1,"b":[{"c":2,"d":3},false,4],"e":{"f":true,"g":[null,true,1.1]}}',1);

#SQL[@13,N69]Result[]
insert into t1 values ('[1,true,false,null,"aaa",1.1,{"t":false}]',2);

#SQL[@14,N16]Result[8, 92, 55]
select * from t1;
a  ¦  b
{"a": 1, "b": [{"c": 2, "d": 3}, false, 4], "e": {"f": true, "g": [null, true, 1.1]}}  ¦  1
[1, true, false, null, "aaa", 1.1, {"t": false}]  ¦  2

#SQL[@15,N31]Error[55]
select * from unnest(t1.a) as f;
invalid input: missing FROM-clause entry for table 't1'

#SQL[@16,N36]Result[63, 135, 135, 162, 162, 169, 169, 99, 99, 102, 102, 103, 103, 102, 102, 103, 103, 101, 101, 110, 110]
select f.* from t1,unnest(t1.a) as f;
col  ¦  seq  ¦  key  ¦  path  ¦  index  ¦  value  ¦  this
t1.a  ¦  0  ¦  a  ¦  $.a  ¦  null  ¦  1  ¦  {"a": 1, "b": [{"c": 2, "d": 3}, false, 4], "e": {"f": true, "g": [null, true, 1.1]}}
t1.a  ¦  0  ¦  a  ¦  $.a  ¦  null  ¦  1  ¦  {"a": 1, "b": [{"c": 2, "d": 3}, false, 4], "e": {"f": true, "g": [null, true, 1.1]}}
t1.a  ¦  1  ¦  b  ¦  $.b  ¦  null  ¦  [{"c": 2, "d": 3}, false, 4]  ¦  {"a": 1, "b": [{"c": 2, "d": 3}, false, 4], "e": {"f": true, "g": [null, true, 1.1]}}
t1.a  ¦  1  ¦  b  ¦  $.b  ¦  null  ¦  [{"c": 2, "d": 3}, false, 4]  ¦  {"a": 1, "b": [{"c": 2, "d": 3}, false, 4], "e": {"f": true, "g": [null, true, 1.1]}}
t1.a  ¦  2  ¦  e  ¦  $.e  ¦  null  ¦  {"f": true, "g": [null, true, 1.1]}  ¦  {"a": 1, "b": [{"c": 2, "d": 3}, false, 4], "e": {"f": true, "g": [null, true, 1.1]}}
t1.a  ¦  2  ¦  e  ¦  $.e  ¦  null  ¦  {"f": true, "g": [null, true, 1.1]}  ¦  {"a": 1, "b": [{"c": 2, "d": 3}, false, 4], "e": {"f": true, "g": [null, true, 1.1]}}
t1.a  ¦  0  ¦  null  ¦  $[0]  ¦  0  ¦  1  ¦  [1, true, false, null, "aaa", 1.1, {"t": false}]
t1.a  ¦  0  ¦  null  ¦  $[0]  ¦  0  ¦  1  ¦  [1, true, false, null, "aaa", 1.1, {"t": false}]
t1.a  ¦  1  ¦  null  ¦  $[1]  ¦  1  ¦  true  ¦  [1, true, false, null, "aaa", 1.1, {"t": false}]
t1.a  ¦  1  ¦  null  ¦  $[1]  ¦  1  ¦  true  ¦  [1, true, false, null, "aaa", 1.1, {"t": false}]
t1.a  ¦  2  ¦  null  ¦  $[2]  ¦  2  ¦  false  ¦  [1, true, false, null, "aaa", 1.1, {"t": false}]
t1.a  ¦  2  ¦  null  ¦  $[2]  ¦  2  ¦  false  ¦  [1, true, false, null, "aaa", 1.1, {"t": false}]
t1.a  ¦  3  ¦  null  ¦  $[3]  ¦  3  ¦  null  ¦  [1, true, false, null, "aaa", 1.1, {"t": false}]
t1.a  ¦  3  ¦  null  ¦  $[3]  ¦  3  ¦  null  ¦  [1, true, false, null, "aaa", 1.1, {"t": false}]
t1.a  ¦  4  ¦  null  ¦  $[4]  ¦  4  ¦  "aaa"  ¦  [1, true, false, null, "aaa", 1.1, {"t": false}]
t1.a  ¦  4  ¦  null  ¦  $[4]  ¦  4  ¦  "aaa"  ¦  [1, true, false, null, "aaa", 1.1, {"t": false}]
t1.a  ¦  5  ¦  null  ¦  $[5]  ¦  5  ¦  1.1  ¦  [1, true, false, null, "aaa", 1.1, {"t": false}]
t1.a  ¦  5  ¦  null  ¦  $[5]  ¦  5  ¦  1.1  ¦  [1, true, false, null, "aaa", 1.1, {"t": false}]
t1.a  ¦  6  ¦  null  ¦  $[6]  ¦  6  ¦  {"t": false}  ¦  [1, true, false, null, "aaa", 1.1, {"t": false}]
t1.a  ¦  6  ¦  null  ¦  $[6]  ¦  6  ¦  {"t": false}  ¦  [1, true, false, null, "aaa", 1.1, {"t": false}]

#SQL[@17,N43]Result[63, 96, 96, 85, 85, 81, 81]
select f.* from t1,unnest(t1.a, "$.b") as f;
col  ¦  seq  ¦  key  ¦  path  ¦  index  ¦  value  ¦  this
t1.a  ¦  0  ¦  null  ¦  $.b[0]  ¦  0  ¦  {"c": 2, "d": 3}  ¦  [{"c": 2, "d": 3}, false, 4]
t1.a  ¦  0  ¦  null  ¦  $.b[0]  ¦  0  ¦  {"c": 2, "d": 3}  ¦  [{"c": 2, "d": 3}, false, 4]
t1.a  ¦  1  ¦  null  ¦  $.b[1]  ¦  1  ¦  false  ¦  [{"c": 2, "d": 3}, false, 4]
t1.a  ¦  1  ¦  null  ¦  $.b[1]  ¦  1  ¦  false  ¦  [{"c": 2, "d": 3}, false, 4]
t1.a  ¦  2  ¦  null  ¦  $.b[2]  ¦  2  ¦  4  ¦  [{"c": 2, "d": 3}, false, 4]
t1.a  ¦  2  ¦  null  ¦  $.b[2]  ¦  2  ¦  4  ¦  [{"c": 2, "d": 3}, false, 4]

#SQL[@18,N43]Result[]
select f.* from t1,unnest(t1.a, "$.a") as f;

#SQL[@19,N49]Result[63, 57, 57]
select f.* from t1,unnest(t1.a, "$.a", true) as f;
col  ¦  seq  ¦  key  ¦  path  ¦  index  ¦  value  ¦  this
t1.a  ¦  0  ¦  null  ¦  $.a  ¦  null  ¦  null  ¦  1
t1.a  ¦  0  ¦  null  ¦  $.a  ¦  null  ¦  null  ¦  1

#SQL[@20,N29]Error[57]
select * from t1,unnest(t1.a);
SQL syntax error: Every table function must have an alias

#SQL[@21,N38]Error[57]
select f.* from t1,unnest(t1.a, "$.b");
SQL syntax error: Every table function must have an alias

#SQL[@22,N47]Result[77, 155, 118]
select * from t1,unnest(t1.a, "$.a", true) as f;
a  ¦  b  ¦  col  ¦  seq  ¦  key  ¦  path  ¦  index  ¦  value  ¦  this
{"a": 1, "b": [{"c": 2, "d": 3}, false, 4], "e": {"f": true, "g": [null, true, 1.1]}}  ¦  1  ¦  t1.a  ¦  0  ¦  null  ¦  $.a  ¦  null  ¦  null  ¦  1
[1, true, false, null, "aaa", 1.1, {"t": false}]  ¦  2  ¦  t1.a  ¦  0  ¦  null  ¦  $.a  ¦  null  ¦  null  ¦  1

#SQL[@23,N43]Result[3, 4, 4, 4, 4, 4, 4]
select col from t1,unnest(t1.a, "$.b") as f;
col
t1.a
t1.a
t1.a
t1.a
t1.a
t1.a

#SQL[@24,N45]Result[3, 4, 4, 4, 4, 4, 4]
select f.col from t1,unnest(t1.a, "$.b") as f;
col
t1.a
t1.a
t1.a
t1.a
t1.a
t1.a

#SQL[@25,N52]Result[12, 11, 11, 11, 11, 11, 11]
select f.seq, f.col from t1,unnest(t1.a, "$.b") as f;
seq  ¦  col
0  ¦  t1.a
0  ¦  t1.a
1  ¦  t1.a
1  ¦  t1.a
2  ¦  t1.a
2  ¦  t1.a

#SQL[@26,N53]Result[5, 1, 1, 1, 1, 1, 1, 1]
select distinct(f.seq) from t1,unnest(t1.a, "$") as f;
f.seq
0
1
2
3
4
5
6

#SQL[@27,N47]Result[15, 13, 13, 13, 13, 13, 13, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11]
select `index`,path from t1,unnest(t1.a, "$") u;
index  ¦  path
null  ¦  $.a
null  ¦  $.a
null  ¦  $.b
null  ¦  $.b
null  ¦  $.e
null  ¦  $.e
0  ¦  $[0]
0  ¦  $[0]
1  ¦  $[1]
1  ¦  $[1]
2  ¦  $[2]
2  ¦  $[2]
3  ¦  $[3]
3  ¦  $[3]
4  ¦  $[4]
4  ¦  $[4]
5  ¦  $[5]
5  ¦  $[5]
6  ¦  $[6]
6  ¦  $[6]

#SQL[@28,N67]Result[15, 11, 11]
select `index`,path from t1,unnest(t1.a, "$") u where u.`index` = 1;
index  ¦  path
1  ¦  $[1]
1  ¦  $[1]

#SQL[@29,N87]Result[15, 13, 13, 13, 13, 13, 13]
select `index`,path from t1,unnest(t1.a, "$") u where u.`index` is null or u.path='$.b';
index  ¦  path
null  ¦  $.a
null  ¦  $.a
null  ¦  $.b
null  ¦  $.b
null  ¦  $.e
null  ¦  $.e

#SQL[@30,N88]Result[15, 13, 13]
select `index`,path from t1,unnest(t1.a, "$") u where u.`index` is null and u.path='$.b';
index  ¦  path
null  ¦  $.b
null  ¦  $.b

#SQL[@31,N56]Result[77, 200, 163]
select * from t1,unnest(t1.a, "$") u where u.`index` = 1;
a  ¦  b  ¦  col  ¦  seq  ¦  key  ¦  path  ¦  index  ¦  value  ¦  this
{"a": 1, "b": [{"c": 2, "d": 3}, false, 4], "e": {"f": true, "g": [null, true, 1.1]}}  ¦  1  ¦  t1.a  ¦  1  ¦  null  ¦  $[1]  ¦  1  ¦  true  ¦  [1, true, false, null, "aaa", 1.1, {"t": false}]
[1, true, false, null, "aaa", 1.1, {"t": false}]  ¦  2  ¦  t1.a  ¦  1  ¦  null  ¦  $[1]  ¦  1  ¦  true  ¦  [1, true, false, null, "aaa", 1.1, {"t": false}]

#SQL[@32,N92]Result[24, 17, 17, 44, 44, 51, 51]
select `key`,path,value from t1, unnest(t1.a, "$") u where u.`index` is null or u.path='$.b';
key  ¦  path  ¦  value
a  ¦  $.a  ¦  1
a  ¦  $.a  ¦  1
b  ¦  $.b  ¦  [{"c": 2, "d": 3}, false, 4]
b  ¦  $.b  ¦  [{"c": 2, "d": 3}, false, 4]
e  ¦  $.e  ¦  {"f": true, "g": [null, true, 1.1]}
e  ¦  $.e  ¦  {"f": true, "g": [null, true, 1.1]}

#SQL[@33,N69]Result[19, 18, 18, 18, 18, 18, 18]
select seq,col,b from t1, unnest(t1.a, "$") u where u.`index` is null;
seq  ¦  col  ¦  b
0  ¦  t1.a  ¦  1
0  ¦  t1.a  ¦  2
1  ¦  t1.a  ¦  1
1  ¦  t1.a  ¦  2
2  ¦  t1.a  ¦  1
2  ¦  t1.a  ¦  2

#SQL[@34,N81]Result[15, 8, 8]
select count(b),b from t1, unnest(t1.a, "$") u where u.`index` is null group by b;
count(b)  ¦  b
3  ¦  1
3  ¦  2

#SQL[@35,N37]Result[]
insert into t1 values ('{"add":1}',1);

#SQL[@36,N87]Result[19, 8, 8, 8]
select count(seq),seq from t1, unnest(t1.a, "$") u where u.`index` is null group by seq;
count(seq)  ¦  seq
6  ¦  0
3  ¦  1
3  ¦  2

#SQL[@37,N105]Result[19, 8, 8, 8]
select count(seq),seq from t1, unnest(t1.a, "$") u where u.`index` is null group by seq order by seq desc;
count(seq)  ¦  seq
3  ¦  2
3  ¦  1
6  ¦  0

#SQL[@38,N143]Result[39, 16, 16, 16, 15, 15, 15, 15]
select count(`index`),`index`,sum(`index`) from t1, unnest(t1.a, "$") u where u.`index` is not null group by `index` order by sum(`index`) desc;
count(index)  ¦  index  ¦  sum(index)
3  ¦  6  ¦  18
3  ¦  5  ¦  15
3  ¦  4  ¦  12
3  ¦  3  ¦  9
3  ¦  2  ¦  6
3  ¦  1  ¦  3
3  ¦  0  ¦  0

#SQL[@39,N112]Result[12, 92, 17]
with u_table as (select * from t1,unnest(t1.a,"$.b",true) u where seq>1) select a,`index` from u_table where b=1;
a  ¦  index
{"a": 1, "b": [{"c": 2, "d": 3}, false, 4], "e": {"f": true, "g": [null, true, 1.1]}}  ¦  2
{"add": 1}  ¦  2

#SQL[@40,N77]Result[70, 154, 157, 158, 157, 158, 156, 165]
with myt as (select a from t1 where t1.b>1) select * from myt,unnest(myt.a) u;
a  ¦  col  ¦  seq  ¦  key  ¦  path  ¦  index  ¦  value  ¦  this
[1, true, false, null, "aaa", 1.1, {"t": false}]  ¦  myt.a  ¦  0  ¦  null  ¦  $[0]  ¦  0  ¦  1  ¦  [1, true, false, null, "aaa", 1.1, {"t": false}]
[1, true, false, null, "aaa", 1.1, {"t": false}]  ¦  myt.a  ¦  1  ¦  null  ¦  $[1]  ¦  1  ¦  true  ¦  [1, true, false, null, "aaa", 1.1, {"t": false}]
[1, true, false, null, "aaa", 1.1, {"t": false}]  ¦  myt.a  ¦  2  ¦  null  ¦  $[2]  ¦  2  ¦  false  ¦  [1, true, false, null, "aaa", 1.1, {"t": false}]
[1, true, false, null, "aaa", 1.1, {"t": false}]  ¦  myt.a  ¦  3  ¦  null  ¦  $[3]  ¦  3  ¦  null  ¦  [1, true, false, null, "aaa", 1.1, {"t": false}]
[1, true, false, null, "aaa", 1.1, {"t": false}]  ¦  myt.a  ¦  4  ¦  null  ¦  $[4]  ¦  4  ¦  "aaa"  ¦  [1, true, false, null, "aaa", 1.1, {"t": false}]
[1, true, false, null, "aaa", 1.1, {"t": false}]  ¦  myt.a  ¦  5  ¦  null  ¦  $[5]  ¦  5  ¦  1.1  ¦  [1, true, false, null, "aaa", 1.1, {"t": false}]
[1, true, false, null, "aaa", 1.1, {"t": false}]  ¦  myt.a  ¦  6  ¦  null  ¦  $[6]  ¦  6  ¦  {"t": false}  ¦  [1, true, false, null, "aaa", 1.1, {"t": false}]

#SQL[@42,N124]Result[70, 158, 156]
with myt as (select a from t1 where t1.b>1) select * from myt,unnest(myt.a) u where json_unquote(value)='false' or `index`=5;
a  ¦  col  ¦  seq  ¦  key  ¦  path  ¦  index  ¦  value  ¦  this
[1, true, false, null, "aaa", 1.1, {"t": false}]  ¦  myt.a  ¦  2  ¦  null  ¦  $[2]  ¦  2  ¦  false  ¦  [1, true, false, null, "aaa", 1.1, {"t": false}]
[1, true, false, null, "aaa", 1.1, {"t": false}]  ¦  myt.a  ¦  5  ¦  null  ¦  $[5]  ¦  5  ¦  1.1  ¦  [1, true, false, null, "aaa", 1.1, {"t": false}]

#SQL[@43,N51]Result[]
create view v1 as (select * from t1,unnest(t1.a) u);

#SQL[@44,N95]Result[19, 8, 8, 8]
select count(seq),seq from v1 where `index` is null or json_unquote(value)='false' group by seq;
count(seq)  ¦  seq
6  ¦  0
3  ¦  1
6  ¦  2

#SQL[@46,N71]Result[24, 17]
select `key`,path,value from unnest(substring('{"a":1}...',1,7), '$') u;
key  ¦  path  ¦  value
a  ¦  $.a  ¦  1

#SQL[@47,N23]Result[]
drop table if exists t2;

#SQL[@48,N32]Result[]
create table t2 (a varchar(100));

#SQL[@49,N34]Result[]
insert into t2 values ('{"a":1}.');

#SQL[@50,N93]Result[70, 73]
with tmpt as (select substring(a,1,7) as a from t2) select * from tmpt, unnest(tmpt.a, '$') u;
a  ¦  col  ¦  seq  ¦  key  ¦  path  ¦  index  ¦  value  ¦  this
{"a":1}  ¦  tmpt.a  ¦  0  ¦  a  ¦  $.a  ¦  null  ¦  1  ¦  {"a": 1}

#SQL[@51,N46]Result[70, 89]
select * from t2,unnest(substring(t2.a,1,7)) u;
a  ¦  col  ¦  seq  ¦  key  ¦  path  ¦  index  ¦  value  ¦  this
{"a":1}.  ¦  substring(t2.a, 1, 7)  ¦  0  ¦  a  ¦  $.a  ¦  null  ¦  1  ¦  {"a": 1}

#SQL[@52,N76]Result[]
create view v3 as (select * from unnest(substring('{"a":1}...',1,7), '$') u);

#SQL[@53,N7]Result[71, 60, 52, 60, 61, 54, 55, 54]
desc v3;
Field  ¦  Type  ¦  Null  ¦  Key  ¦  Default  ¦  Extra  ¦  Comment
col  ¦  VARCHAR(65535)  ¦  YES  ¦    ¦  null  ¦    ¦  
seq  ¦  INT(4)  ¦  YES  ¦    ¦  null  ¦    ¦  
key  ¦  VARCHAR(65535)  ¦  YES  ¦    ¦  null  ¦    ¦  
path  ¦  VARCHAR(65535)  ¦  YES  ¦    ¦  null  ¦    ¦  
index  ¦  INT(4)  ¦  YES  ¦    ¦  null  ¦    ¦  
value  ¦  JSON(0)  ¦  YES  ¦    ¦  null  ¦    ¦  
this  ¦  JSON(0)  ¦  YES  ¦    ¦  null  ¦    ¦  

#SQL[@54,N23]Result[]
drop table if exists t1;

#SQL[@55,N29]Result[]
create table t1(a int,b json);

#SQL[@56,N97]Result[]
insert into t1 values(1,'{"people":[{"name":"a1","address":"a2"},{"name":"b1","address":"b2"}]}');

#SQL[@57,N97]Result[]
insert into t1 values(2,'{"people":[{"name":"c1","address":"c2"},{"name":"d1","address":"d2"}]}');

#SQL[@58,N105]Result[70, 113, 113]
select a,e.* from t1,unnest(t1.b,'$.people[0]') e where seq=0 and e.this=json_extract(t1.b,'$.people[0]');
a  ¦  col  ¦  seq  ¦  key  ¦  path  ¦  index  ¦  value  ¦  this
1  ¦  t1.b  ¦  0  ¦  address  ¦  $.people[0].address  ¦  null  ¦  "a2"  ¦  {"address": "a2", "name": "a1"}
2  ¦  t1.b  ¦  0  ¦  address  ¦  $.people[0].address  ¦  null  ¦  "c2"  ¦  {"address": "c2", "name": "c1"}

