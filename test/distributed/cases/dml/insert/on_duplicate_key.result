#SQL[@1,N41]Result[]
create table t1(a int primary key, b int);

#SQL[@2,N14]Result[]
delete from t1;

#SQL[@3,N27]Result[]
insert into t1 values (1,1);

#SQL[@4,N65]Result[]
insert into t1 values (1,2), (2,2) on duplicate key update b=b+10;

#SQL[@5,N16]Result[8, 9, 8]
select * from t1;
a  ¦  b
1  ¦  11
2  ¦  2

#SQL[@6,N14]Result[]
delete from t1;

#SQL[@7,N27]Result[]
insert into t1 values (1,1);

#SQL[@8,N73]Result[]
insert into t1 values (1,2), (2,2) on duplicate key update b=values(b)+10;

#SQL[@9,N16]Result[8, 9, 8]
select * from t1;
a  ¦  b
1  ¦  12
2  ¦  2

#SQL[@10,N14]Result[]
delete from t1;

#SQL[@11,N27]Result[]
insert into t1 values (1,1);

#SQL[@12,N80]Error[88]
insert into t1 values (1,11), (2,22), (3,33) on duplicate key update a=a+1,b=100;
internal error: do not support update primary key/unique key for on duplicate key update

#SQL[@16,N14]Result[]
delete from t1;

#SQL[@17,N27]Result[]
insert into t1 values (1,1);

#SQL[@18,N66]Result[]
insert into t1 values (1,2), (1,22) on duplicate key update b=b+10;

#SQL[@19,N16]Result[8, 9]
select * from t1;
a  ¦  b
1  ¦  21

#SQL[@20,N14]Result[]
delete from t1;

#SQL[@21,N33]Result[]
insert into t1 values (1,1),(3,3);

#SQL[@22,N64]Error[88]
insert into t1 values (1,2),(2,22) on duplicate key update a=a+1;
internal error: do not support update primary key/unique key for on duplicate key update

#SQL[@23,N14]Result[]
delete from t1;

#SQL[@24,N33]Result[]
insert into t1 values (1,1),(3,3);

#SQL[@25,N71]Error[88]
insert into t1 values (1,2),(2,22),(3,33) on duplicate key update a=a+1;
internal error: do not support update primary key/unique key for on duplicate key update

#SQL[@26,N13]Result[]
drop table t1;

#SQL[@27,N55]Result[]
create table t1(a int, b int, c int, primary key(a, b));

#SQL[@28,N14]Result[]
delete from t1;

#SQL[@29,N29]Result[]
insert into t1 values (1,1,1);

#SQL[@30,N69]Result[]
insert into t1 values (1,1,2), (2,2,2) on duplicate key update c=c+10;

#SQL[@31,N16]Result[15, 16, 15]
select * from t1;
a  ¦  b  ¦  c
1  ¦  1  ¦  11
2  ¦  2  ¦  2

#SQL[@32,N14]Result[]
delete from t1;

#SQL[@33,N29]Result[]
insert into t1 values (1,1,1);

#SQL[@34,N77]Result[]
insert into t1 values (1,1,2), (2,2,2) on duplicate key update c=values(c)+10;

#SQL[@35,N16]Result[15, 16, 15]
select * from t1;
a  ¦  b  ¦  c
1  ¦  1  ¦  12
2  ¦  2  ¦  2

#SQL[@36,N13]Result[]
drop table t1;

#SQL[@37,N63]Result[]
create table t1(a int, b int, c int, primary key(a, b), key(c));

#SQL[@38,N14]Result[]
delete from t1;

#SQL[@39,N29]Result[]
insert into t1 values (1,1,1);

#SQL[@40,N69]Result[]
insert into t1 values (1,1,2), (2,2,2) on duplicate key update c=c+10;

#SQL[@41,N16]Result[15, 16, 15]
select * from t1;
a  ¦  b  ¦  c
1  ¦  1  ¦  11
2  ¦  2  ¦  2

#SQL[@42,N14]Result[]
delete from t1;

#SQL[@43,N29]Result[]
insert into t1 values (1,1,1);

#SQL[@44,N77]Result[]
insert into t1 values (1,1,2), (2,2,2) on duplicate key update c=values(c)+10;

#SQL[@45,N16]Result[15, 16, 15]
select * from t1;
a  ¦  b  ¦  c
1  ¦  1  ¦  12
2  ¦  2  ¦  2

#SQL[@46,N13]Result[]
drop table t1;

#SQL[@47,N66]Result[]
create table t1(a int, b int, c int, primary key(a, b), key(b, c));

#SQL[@48,N14]Result[]
delete from t1;

#SQL[@49,N29]Result[]
insert into t1 values (1,1,1);

#SQL[@50,N78]Result[]
insert into t1 values (1,1,2), (2,2,2), (2,2,3) on duplicate key update c=c+10;

#SQL[@51,N16]Result[15, 16, 16]
select * from t1;
a  ¦  b  ¦  c
1  ¦  1  ¦  11
2  ¦  2  ¦  12

#SQL[@52,N14]Result[]
delete from t1;

#SQL[@53,N29]Result[]
insert into t1 values (1,1,1);

#SQL[@54,N86]Result[]
insert into t1 values (1,1,2), (2,2,2), (2,2,3) on duplicate key update c=values(c)+10;

#SQL[@55,N16]Result[15, 16, 16]
select * from t1;
a  ¦  b  ¦  c
1  ¦  1  ¦  12
2  ¦  2  ¦  13

#SQL[@56,N13]Result[]
drop table t1;

#SQL[@57,N40]Result[]
create table t1(a int unique key, b int);

#SQL[@58,N14]Result[]
delete from t1;

#SQL[@59,N27]Result[]
insert into t1 values (1,1);

#SQL[@60,N65]Result[]
insert into t1 values (1,2), (2,2) on duplicate key update b=b+10;

#SQL[@61,N16]Result[8, 9, 8]
select * from t1;
a  ¦  b
1  ¦  11
2  ¦  2

#SQL[@62,N14]Result[]
delete from t1;

#SQL[@63,N27]Result[]
insert into t1 values (1,1);

#SQL[@64,N73]Result[]
insert into t1 values (1,2), (2,2) on duplicate key update b=values(b)+10;

#SQL[@65,N16]Result[8, 9, 8]
select * from t1;
a  ¦  b
1  ¦  12
2  ¦  2

#SQL[@66,N14]Result[]
delete from t1;

#SQL[@67,N27]Result[]
insert into t1 values (1,1);

#SQL[@68,N80]Error[88]
insert into t1 values (1,11), (2,22), (3,33) on duplicate key update a=a+1,b=100;
internal error: do not support update primary key/unique key for on duplicate key update

#SQL[@72,N14]Result[]
delete from t1;

#SQL[@73,N27]Result[]
insert into t1 values (1,1);

#SQL[@74,N66]Result[]
insert into t1 values (1,2), (1,22) on duplicate key update b=b+10;

#SQL[@75,N16]Result[8, 9]
select * from t1;
a  ¦  b
1  ¦  21

#SQL[@76,N14]Result[]
delete from t1;

#SQL[@77,N33]Result[]
insert into t1 values (1,1),(3,3);

#SQL[@78,N64]Error[88]
insert into t1 values (1,2),(2,22) on duplicate key update a=a+1;
internal error: do not support update primary key/unique key for on duplicate key update

#SQL[@79,N14]Result[]
delete from t1;

#SQL[@80,N33]Result[]
insert into t1 values (1,1),(3,3);

#SQL[@81,N71]Error[88]
insert into t1 values (1,2),(2,22),(3,33) on duplicate key update a=a+1;
internal error: do not support update primary key/unique key for on duplicate key update

#SQL[@82,N13]Result[]
drop table t1;

#SQL[@83,N54]Result[]
create table t1(a int, b int, c int, unique key(a, b));

#SQL[@84,N14]Result[]
delete from t1;

#SQL[@85,N29]Result[]
insert into t1 values (1,1,1);

#SQL[@86,N69]Result[]
insert into t1 values (1,1,2), (2,2,2) on duplicate key update c=c+10;

#SQL[@87,N16]Result[15, 16, 15]
select * from t1;
a  ¦  b  ¦  c
1  ¦  1  ¦  11
2  ¦  2  ¦  2

#SQL[@88,N14]Result[]
delete from t1;

#SQL[@89,N29]Result[]
insert into t1 values (1,1,1);

#SQL[@90,N77]Result[]
insert into t1 values (1,1,2), (2,2,2) on duplicate key update c=values(c)+10;

#SQL[@91,N16]Result[15, 16, 15]
select * from t1;
a  ¦  b  ¦  c
1  ¦  1  ¦  12
2  ¦  2  ¦  2

#SQL[@92,N13]Result[]
drop table t1;

#SQL[@93,N250]Result[]
CREATE TABLE IF NOT EXISTS indup_00(`id` INT UNSIGNED,`act_name` VARCHAR(20) NOT NULL,`spu_id` VARCHAR(30) NOT NULL,`uv`  BIGINT NOT NULL,`update_time` date default '2020-10-10' COMMENT 'lastest time',unique key idx_act_name_spu_id (act_name,spu_id));

#SQL[@94,N135]Result[]
insert into indup_00 values (1,'beijing','001',1,'2021-01-03'),(2,'shanghai','002',2,'2022-09-23'),(3,'guangzhou','003',3,'2022-09-23');

#SQL[@95,N34]Result[53, 46, 47, 48]
select * from indup_00 order by id;
id  ¦  act_name  ¦  spu_id  ¦  uv  ¦  update_time
1  ¦  beijing  ¦  001  ¦  1  ¦  2021-01-03
2  ¦  shanghai  ¦  002  ¦  2  ¦  2022-09-23
3  ¦  guangzhou  ¦  003  ¦  3  ¦  2022-09-23

#SQL[@96,N202]Error[88]
insert into indup_00 values (6,'shanghai','002',21,'1999-09-23'),(7,'guangzhou','003',31,'1999-09-23') on duplicate key update `act_name`=VALUES(`act_name`), `spu_id`=VALUES(`spu_id`), `uv`=VALUES(`uv`);
internal error: do not support update primary key/unique key for on duplicate key update

#SQL[@100,N19]Result[]
drop table indup_00;

#SQL[@101,N134]Result[]
CREATE TABLE IF NOT EXISTS indup(
col1 INT primary key,
col2 VARCHAR(20) NOT NULL,
col3 VARCHAR(30) NOT NULL,
col4 BIGINT default 30
);

#SQL[@107,N148]Error[88]
insert into indup values(22,'11','33',1), (23,'22','55',2),(24,'66','77',1),(25,'99','88',1),(22,'11','33',1) on duplicate key update col1=col1+col2;
internal error: do not support update primary key/unique key for on duplicate key update

#SQL[@113,N16]Result[]
drop table indup;

#SQL[@114,N48]Result[]
create table t1(a int primary key, b int, c int);

#SQL[@115,N37]Result[]
insert into t1 values (1,1,1),(2,2,2);

#SQL[@116,N75]Error[88]
insert into t1 values (1,9,1),(11,8,2) on duplicate key update a=a+10, c=10;
internal error: do not support update primary key/unique key for on duplicate key update

#SQL[@121,N23]Result[]
drop table if exists t1;

#SQL[@122,N52]Result[]
create table t1(a int primary key, b int unique key);

#SQL[@123,N39]Result[]
insert into t1 values (1,1),(2,2),(3,3);

#SQL[@124,N62]Error[88]
insert into t1 values (1,20) on duplicate key update b = b + 1;
internal error: do not support update primary key/unique key for on duplicate key update

#SQL[@125,N62]Error[88]
insert into t1 values (20,1) on duplicate key update a = a + 1;
internal error: do not support update primary key/unique key for on duplicate key update

#SQL[@126,N14]Result[]
delete from t1;

#SQL[@127,N33]Result[]
insert into t1 values (1,1),(3,2);

#SQL[@128,N58]Error[88]
insert into t1 values (1,2) on duplicate key update a = 10;
internal error: do not support update primary key/unique key for on duplicate key update

#SQL[@129,N14]Result[]
delete from t1;

#SQL[@130,N33]Result[]
insert into t1 values (1,1),(3,2);

#SQL[@131,N59]Error[88]
insert into t1 values (1,2) on duplicate key update a = a+2;
internal error: do not support update primary key/unique key for on duplicate key update

#SQL[@133,N23]Result[]
drop table if exists t1;

#SQL[@134,N74]Result[]
create table t1(a int primary key, b int) partition by key(a) partitions 2;

#SQL[@135,N33]Result[]
insert into t1 values (1,1),(2,2);

#SQL[@136,N64]Result[]
insert into t1 values (1,1),(3,3) on duplicate key update b = 10;

#SQL[@137,N27]Result[8, 9, 8, 8]
select * from t1 order by a;
a  ¦  b
1  ¦  10
2  ¦  2
3  ¦  3

#SQL[@138,N23]Result[]
drop table if exists t1;

#SQL[@139,N89]Result[]
create table t1(a int, b int, c int, primary key(a,b)) partition by key(a,b) partitions 2;

#SQL[@140,N37]Result[]
insert into t1 values (1,1,1),(2,2,2);

#SQL[@141,N68]Result[]
insert into t1 values (1,1,1),(3,3,3) on duplicate key update c = 10;

#SQL[@142,N27]Result[15, 16, 15, 15]
select * from t1 order by a;
a  ¦  b  ¦  c
1  ¦  1  ¦  10
2  ¦  2  ¦  2
3  ¦  3  ¦  3

#SQL[@143,N23]Result[]
drop table if exists t1;

#SQL[@144,N41]Result[]
create table t1(a int primary key, b int);

#SQL[@145,N33]Result[]
insert into t1 values (1,1),(2,2);

#SQL[@146,N74]Result[]
prepare s1 from insert into t1 values (?,2) on duplicate key update b = 10;

#SQL[@147,N8]Result[]
set @a=1;

#SQL[@148,N19]Result[]
execute s1 using @a;

#SQL[@149,N19]Result[]
execute s1 using @a;

#SQL[@150,N19]Result[]
execute s1 using @a;

#SQL[@151,N19]Result[]
execute s1 using @a;

#SQL[@153,N26]Result[]
drop table if exists users;

#SQL[@154,N187]Result[]
create table users (id int primary key auto_increment, counter int, create_at datetime default current_timestamp, update_at datetime default current_timestamp on update current_timestamp);

#SQL[@155,N48]Result[]
insert into users (id, counter) values ('112',1);

#SQL[@156,N52]Result[42, 20]
select id, counter, create_at = update_at from users;
id  ¦  counter  ¦  create_at = update_at
112  ¦  1  ¦  true

#SQL[@157,N15]Result[8, 1]
select sleep(1);
sleep(1)
0

#SQL[@158,N135]Result[]
insert into users (id, counter) values ('112',2) on duplicate key update counter=counter+values(counter), create_at=current_timestamp();

#SQL[@159,N52]Result[42, 20]
select id, counter, create_at = update_at from users;
id  ¦  counter  ¦  create_at = update_at
112  ¦  3  ¦  true

