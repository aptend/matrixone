#SQL[@1,N30]Result[]
drop database if exists testdb;

#SQL[@2,N22]Result[]
create database testdb;

#SQL[@3,N10]Result[]
use testdb;

#SQL[@5,N31]Result[24, 4]
select enable_fault_injection();
enable_fault_injection()
true

#SQL[@7,N42]Result[]
create table t1 (a int primary key, b int);

#SQL[@8,N76]Result[65, 4]
select add_fault_point('fj/cn/flush_small_objs',':::','echo',40,'testdb.t1');
add_fault_point(fj/cn/flush_small_objs, :::, echo, 40, testdb.t1)
true

#SQL[@9,N57]Result[]
insert into t1 select *, * from generate_series(1,81920)g;

#SQL[@11,N61]Result[1, 4, 4, 4]
select b from t1 where a between 8191 and 8193 order by b asc;
b
8191
8192
8193

#SQL[@12,N13]Result[]
drop table t1;

#SQL[@14,N50]Result[]
create table t2 (a varchar primary key, b varchar);

#SQL[@15,N76]Result[65, 4]
select add_fault_point('fj/cn/flush_small_objs',':::','echo',40,'testdb.t2');
add_fault_point(fj/cn/flush_small_objs, :::, echo, 40, testdb.t2)
true

#SQL[@16,N57]Result[]
insert into t2 select *, * from generate_series(1,81920)g;

#SQL[@18,N55]Result[1, 1, 1, 1]
select b from t2 where a between 1 and 3 order by b asc;
b
1
2
3

#SQL[@19,N13]Result[]
drop table t2;

#SQL[@21,N50]Result[]
create table t3 (a decimal primary key, b decimal);

#SQL[@22,N76]Result[65, 4]
select add_fault_point('fj/cn/flush_small_objs',':::','echo',40,'testdb.t3');
add_fault_point(fj/cn/flush_small_objs, :::, echo, 40, testdb.t3)
true

#SQL[@23,N57]Result[]
insert into t3 select *, * from generate_series(1,81920)g;

#SQL[@25,N57]Result[1, 2, 2, 2, 2]
select b from t3 where a between 10 and 13 order by b asc;
b
10
11
12
13

#SQL[@26,N13]Result[]
drop table t3;

#SQL[@29,N40]Result[]
create table t4 (a int, b int, index(b));

#SQL[@30,N76]Result[65, 4]
select add_fault_point('fj/cn/flush_small_objs',':::','echo',40,'testdb.t4');
add_fault_point(fj/cn/flush_small_objs, :::, echo, 40, testdb.t4)
true

#SQL[@31,N57]Result[]
insert into t4 select *, * from generate_series(1,81920)g;

#SQL[@33,N61]Result[1, 4, 4, 4]
select a from t4 where b between 8191 and 8193 order by a asc;
a
8191
8192
8193

#SQL[@34,N13]Result[]
drop table t4;

#SQL[@36,N48]Result[]
create table t5 (a varchar, b varchar, index(b));

#SQL[@37,N76]Result[65, 4]
select add_fault_point('fj/cn/flush_small_objs',':::','echo',40,'testdb.t5');
add_fault_point(fj/cn/flush_small_objs, :::, echo, 40, testdb.t5)
true

#SQL[@38,N57]Result[]
insert into t5 select *, * from generate_series(1,81920)g;

#SQL[@40,N55]Result[1, 1, 1, 1]
select a from t5 where b between 1 and 3 order by a asc;
a
1
2
3

#SQL[@41,N13]Result[]
drop table t5;

#SQL[@43,N48]Result[]
create table t6 (a decimal, b decimal, index(b));

#SQL[@44,N76]Result[65, 4]
select add_fault_point('fj/cn/flush_small_objs',':::','echo',40,'testdb.t6');
add_fault_point(fj/cn/flush_small_objs, :::, echo, 40, testdb.t6)
true

#SQL[@45,N57]Result[]
insert into t6 select *, * from generate_series(1,81920)g;

#SQL[@47,N57]Result[1, 2, 2, 2, 2]
select a from t6 where b between 10 and 13 order by a asc;
a
10
11
12
13

#SQL[@48,N13]Result[]
drop table t6;

#SQL[@50,N20]Result[]
drop database testdb;

#SQL[@51,N32]Result[25, 4]
select disable_fault_injection();
disable_fault_injection()
true

