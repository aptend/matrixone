create database if not exists db;
use db;
drop table if exists t;
create table t (a int, b int, primary key (a));
insert into t values (1, 1), (2, 2), (3, 3), (4,4), (5, 5);
select mo_ctl('dn', 'inspect', 'addc -d db -b t -n aplus -t samllint -p 2');
mo_ctl(dn, inspect, addc -d db -b t -n aplus -t samllint -p 2)
{\n  "method": "Inspect",\n  "result": [\n    {\n      "msg": "add column success"\n    }\n  ]\n}\n
show columns from t;
Field    Type    Null    Key    Default    Extra    Comment
a    INT(32)    NO    PRI    null        
b    INT(32)    YES        null        
aplus    INT UNSIGNED(0)    YES        null        
select * from t;
a    b    aplus
1    1    null
2    2    null
3    3    null
4    4    null
5    5    null
insert into t values (6, 6,6), (7,7,7);
select mo_ctl('dn', 'flush', 'db.t');
mo_ctl(dn, flush, db.t)
{\n  "method": "Flush",\n  "result": [\n    {\n      "returnStr": "OK"\n    }\n  ]\n}\n
select aplus from t;
aplus
6
7
null
null
null
null
null
update t set aplus = 11 where a = 1;
update t set aplus = 61 where a = 6;
select * from t;
a    b    aplus
1    1    11
6    6    61
7    7    7
2    2    null
3    3    null
4    4    null
5    5    null
select mo_ctl('dn', 'inspect', 'dropc -d db -b t -p 2');
mo_ctl(dn, inspect, dropc -d db -b t -p 2)
{\n  "method": "Inspect",\n  "result": [\n    {\n      "msg": "drop column success"\n    }\n  ]\n}\n
select mo_ctl('dn', 'inspect', 'addc -d db -b t -n aminus -t samllint -p 0');
mo_ctl(dn, inspect, addc -d db -b t -n aminus -t samllint -p 0)
{\n  "method": "Inspect",\n  "result": [\n    {\n      "msg": "add column success"\n    }\n  ]\n}\n
show columns from t;
Field    Type    Null    Key    Default    Extra    Comment
aminus    INT UNSIGNED(0)    YES        null        
a    INT(32)    NO    PRI    null        
b    INT(32)    YES        null        
select attname, attr_seqnum from mo_catalog.mo_columns where att_relname = "t";
attname    attr_seqnum
__mo_rowid    65535
a    0
aminus    3
b    1
select relname, rel_version from mo_catalog.mo_tables where reldatabase = "db";
relname    rel_version
%!%mo_increment_columns    0
t    3
insert into t values (12, 12, 12);
select * from t;
aminus    a    b
null    1    1
null    6    6
12    12    12
null    7    7
null    2    2
null    3    3
null    4    4
null    5    5
show tables;
Tables_in_db
t
select mo_ctl('dn', 'inspect', 'renamet -d db -o t -n newt');
mo_ctl(dn, inspect, renamet -d db -o t -n newt)
{\n  "method": "Inspect",\n  "result": [\n    {\n      "msg": "rename table success"\n    }\n  ]\n}\n
select * from t;
SQL parser error: table "t" does not exist
select * from newt;
aminus    a    b
null    1    1
null    6    6
12    12    12
null    7    7
null    2    2
null    3    3
null    4    4
null    5    5
select attname, attr_seqnum from mo_catalog.mo_columns where att_relname = "t";
attname    attr_seqnum
select attname, attr_seqnum from mo_catalog.mo_columns where att_relname = "newt";
attname    attr_seqnum
__mo_rowid    65535
a    0
aminus    3
b    1
select relname, rel_version from mo_catalog.mo_tables where reldatabase = "db";
relname    rel_version
%!%mo_increment_columns    0
newt    4
drop database db;
